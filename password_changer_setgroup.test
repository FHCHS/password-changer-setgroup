<?php
// $Id: password_changer_setgroup.test,v 0.1 2011/01/27 23:28:11 arod Exp $

/**
 * @file
 * Test case for Testing the page example module.
 *
 * This file contains the test cases to check if module is performing as
 * expected.
 *
 */
//Include files

//Installing module if I can use the 


//Extends DrupalWebTestCase to get database connection
class PasswordChangerSetgroupCase extends DrupalWebTestCase  {


  public static function getInfo() {
    return array(
      'name' => 'Password Changer Set User in Group - Configuration',
      'description' => 'Test if user with with 9 characters long user name are set in UNIVERSAL ESTUDENT group and
                        user with 6 six charecter user names set role Employee.',
      'group' => 'Password Changer',
    );
  }
  
  function setUp() {
    parent::setUp('password_changer_setgroup');
    
    //This is creating a Drupal role for students
    $this->drupalCreateRole(array(),'UNIVERSAL STUDENTS');
    
    //This is creating a Drupal role for Employee
    $this->drupalCreateRole(array(),'Employees');
    
    //Getting roles and indexing them by name
    $this->role_by_name = array_flip(user_roles());
    
    //Diplay roles in test screen
    //debug($this->role_by_name);
    
    //Check that role is Universal Student has been created
    $this->assertTrue(isset($this->role_by_name['UNIVERSAL STUDENTS']), 'UNIVERSAL STUDENTS role has been created on Drupal.');
    
    //Check that role 
    $this->assertTrue(isset($this->role_by_name['Employees']), 'Employees role has been created on Drupal');
    
  }
  
    // Test Case 1.1 
  function testPasswordChangerSetgroupCaseLoginEmployee() {
    
    
    
    //Create student user
    //Set user values
    $edit['name']   = 'arrc30';
    $edit['mail']   = 'arrc30' . '@example.com';
    $edit['roles']  =  array( $this->role_by_name['authenticated user']=> 'authenticated user');
    $edit['pass']   = 'test34';
    $edit['status'] = 1;
    
    //Creat user
    $this->employee_user = user_save('', $edit);
    $this->employee_user->pass_raw = $edit['pass'];    
    
    //Check if role was added to the user
    $this->assertTrue(in_array('authenticated user',$this->employee_user->roles), 'The authenticated user role has been added to the student user.' );
    
    //User is not part of the Employee group
    $this->assertFalse(in_array('Employees', $this->employee_user->roles), 'User is not part of the Employee group in Drupal.');
    
    //Login user when login user will be added to the Employee group
    $this->drupalLogin($this->employee_user);
        
    $employee = user_load($this->employee_user->uid, TRUE);
    
    $this->assertTrue(in_array('Employees', $employee->roles), 'User is part of the Employee group in Drupal.');
    
    //debug($employee,'Employee Reload: ');
    

  }

  // Test Case 1.2
  function testPasswordChangerSetgroupCaseLoginStudent() {
    
 
   //Create employee user
    //Set user values
    $edit['name']   = '000172199';
    $edit['mail']   = '000172199' . '@example.com';
    $edit['roles']  = array( $this->role_by_name['authenticated user']=> 'authenticated user');
    $edit['pass']   = 'test34';
    $edit['status'] = 1;
    
    //Creat user
    $this->student_user = user_save('', $edit);
    $this->student_user->pass_raw = $edit['pass'];
    
     //Check if role was added to the user
    $this->assertTrue(in_array('authenticated user',$this->student_user->roles), 'The authenticated user role has been added to the student user.' );
    
    $this->assertFalse(in_array('UNIVERSAL STUDENTS', $this->student_user->roles), 'User is not part of the UNIVERSAL STUDENTS group in Drupal.');
    
    $this->drupalLogin($this->student_user);
     
    $student = user_load($this->student_user->uid, TRUE);
    
    $this->assertTrue(in_array('UNIVERSAL STUDENTS', $student->roles), 'User is part of the UNIVERSAL STUDENTS group in Drupal.');
    
    //debug($student, 'Student Reload:');
    
  }
  
  
}

